---
id: backend
title: Backend
hide_title: true
---

import BackendSDKTabs from "/src/components/tabs/BackendSDKTabs";
import TabItem from '@theme/TabItem';
import NodeJSFrameworkSubTabsServerless from "/src/components/tabs/NodeJSFrameworkSubTabsServerless"
import GoFrameworkSubTabs from "/src/components/tabs/GoFrameworkSubTabs"

# Backend Integration (5 mins)

## Example
<BackendSDKTabs>
<TabItem value="nodejs">

An example implementation can be [found here](https://github.com/supertokens/supertokens-auth-react/blob/master/examples/with-emailpassword/api-server.js).

</TabItem>
<TabItem value="go">

Examples can be found [here](https://github.com/supertokens/supertokens-golang/tree/master/examples)

</TabItem>
</BackendSDKTabs>

## 1Ô∏è) Install

<BackendSDKTabs>
<TabItem value="nodejs">

```bash
npm i -s supertokens-node
```

</TabItem>
<TabItem value="go">

```bash
go get github.com/supertokens/supertokens-golang
```

</TabItem>
</BackendSDKTabs>

## 2Ô∏è) Call the `init` function

Initialise SuperTokens on server startup.

:::important
- Please make sure to replace all the `appInfo` configurations values with yours.
- To learn more about filling in `appInfo`, please visit [the appInfo page](../appinfo)
- If you would like to configure a specific path for you APIs, you can do so by setting the `apiBasePath` value in the config. For example, if your API path is `www.example.com/api` then you can set the value of `apiBasePath` to `/api`.
:::

<BackendSDKTabs>
<TabItem value="nodejs">
<NodeJSFrameworkSubTabsServerless>
<TabItem value="express">

```jsx
let supertokens = require("supertokens-node");
let Session = require("supertokens-node/recipe/session");
let EmailPassword = require("supertokens-node/recipe/emailpassword");

supertokens.init({
    framework: "express",
    supertokens: {
        connectionURI: "https://try.supertokens.io",
    },
    appInfo: {
        // learn more about this on https://supertokens.io/docs/session/appinfo
        appName: "YOUR APP NAME", // Example: "SuperTokens",
        apiDomain: "YOUR API DOMAIN", // Example: "https://api.supertokens.io",
        websiteDomain: "YOUR WEBSITE DOMAIN", // Example: "https://supertokens.io"
    },
    recipeList: [
        EmailPassword.init(), // initializes signin / sign up features 
        Session.init() // initializes session features
    ]
});
```
</TabItem>

<TabItem value="hapi">

```jsx
let supertokens = require("supertokens-node");
let Session = require("supertokens-node/recipe/session");
let EmailPassword = require("supertokens-node/recipe/emailpassword");

supertokens.init({
    framework: "hapi",
    supertokens: {
        connectionURI: "https://try.supertokens.io",
    },
    appInfo: {
        // learn more about this on https://supertokens.io/docs/session/appinfo
        appName: "YOUR APP NAME", // Example: "SuperTokens",
        apiDomain: "YOUR API DOMAIN", // Example: "https://api.supertokens.io",
        websiteDomain: "YOUR WEBSITE DOMAIN" // Example: "https://supertokens.io"
    },
    recipeList: [
        EmailPassword.init(), // initializes signin / sign up features 
        Session.init() // initializes session features
    ]
});
```
</TabItem>

<TabItem value="fastify">

```jsx
let supertokens = require("supertokens-node");
let Session = require("supertokens-node/recipe/session");
let EmailPassword = require("supertokens-node/recipe/emailpassword");

supertokens.init({
    framework: "fastify",
    supertokens: {
        connectionURI: "https://try.supertokens.io",
    },
    appInfo: {
        // learn more about this on https://supertokens.io/docs/session/appinfo
        appName: "YOUR APP NAME", // Example: "SuperTokens",
        apiDomain: "YOUR API DOMAIN", // Example: "https://api.supertokens.io",
        websiteDomain: "YOUR WEBSITE DOMAIN" // Example: "https://supertokens.io"
    },
    recipeList: [
        EmailPassword.init(), // initializes signin / sign up features 
        Session.init() // initializes session features
    ]
});
```
</TabItem>

<TabItem value="koa">

```jsx
let supertokens = require("supertokens-node");
let Session = require("supertokens-node/recipe/session");
let EmailPassword = require("supertokens-node/recipe/emailpassword");

supertokens.init({
    framework: "koa",
    supertokens: {
        connectionURI: "https://try.supertokens.io",
    },
    appInfo: {
        // learn more about this on https://supertokens.io/docs/session/appinfo
        appName: "YOUR APP NAME", // Example: "SuperTokens",
        apiDomain: "YOUR API DOMAIN", // Example: "https://api.supertokens.io",
        websiteDomain: "YOUR WEBSITE DOMAIN" // Example: "https://supertokens.io"
    },
    recipeList: [
        EmailPassword.init(), // initializes signin / sign up features 
        Session.init() // initializes session features
    ]
});
```
</TabItem>

<TabItem value="loopback">

```jsx
let supertokens = require("supertokens-node");
let Session = require("supertokens-node/recipe/session");
let EmailPassword = require("supertokens-node/recipe/emailpassword");

supertokens.init({
    framework: "loopback",
    supertokens: {
        connectionURI: "https://try.supertokens.io",
    },
    appInfo: {
        // learn more about this on https://supertokens.io/docs/session/appinfo
        appName: "YOUR APP NAME", // Example: "SuperTokens",
        apiDomain: "YOUR API DOMAIN", // Example: "https://api.supertokens.io",
        websiteDomain: "YOUR WEBSITE DOMAIN" // Example: "https://supertokens.io"
    },
    recipeList: [
        EmailPassword.init(), // initializes signin / sign up features 
        Session.init() // initializes session features
    ]
});
```
</TabItem>
</NodeJSFrameworkSubTabsServerless>
</TabItem>
<TabItem value="go">

```go
import (
	"github.com/supertokens/supertokens-golang/recipe/emailpassword"
	"github.com/supertokens/supertokens-golang/recipe/session"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
	err := supertokens.Init(supertokens.TypeInput{
		Supertokens: &supertokens.ConnectionInfo{
			ConnectionURI: "https://try.supertokens.io",
		},
		AppInfo: supertokens.AppInfo{
			AppName:       "YOUR APP NAME",       // Example: "SuperTokens"
			APIDomain:     "YOUR API DOMAIN",     // Example: "https://api.supertokens.io",
			WebsiteDomain: "YOUR WEBSITE DOMAIN", // Example: "https://supertokens.io"
		},
		RecipeList: []supertokens.Recipe{
			emailpassword.Init(nil),
			session.Init(nil),
		},
	})

	if err != nil {
		panic(err.Error())
	}
}
```
</TabItem>
</BackendSDKTabs>

We used `https://try.supertokens.io` as the `connectionURI` above. This is a Core that we are hosting for the demo app. 

You can continue to use this for as long as you like, but once you are more committed to using SuperTokens, you will need to run a Core dedicated for your app.

## 3Ô∏è) Add the SuperTokens middleware & CORS setup

<BackendSDKTabs>
<TabItem value="nodejs">
<NodeJSFrameworkSubTabsServerless>
<TabItem value="express">

Add the `middleware` **BEFORE all your routes**.

```jsx
let cors = require("cors");
let supertokens = require("supertokens-node");
let {middleware} = require("supertokens-node/framework/express");

supertokens.init({...}) // from step 2

let app = express();

// ...other middlewares
app.use(cors({
    origin: websiteUrl,
    // highlight-start
    allowedHeaders: ["content-type", ...supertokens.getAllCORSHeaders()],
    credentials: true,
    // highlight-end
}));

// highlight-next-line
app.use(middleware());

// ...your API routes
```
This `middleware` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)):
- `POST /auth/signup`: For signing up a user with email & password
- `POST /auth/signin`: For signing in a user with email & password

`/auth/` is a base path that [can be changed](../common-customizations/changing-base-path/api-base-path) if you want. 


</TabItem>
<TabItem value="hapi">

Register the `plugin`.

```jsx
let supertokens = require("supertokens-node");
let { plugin } = require("supertokens-node/framework/hapi");

supertokens.init({...}) // from step 2

let server = Hapi.server({ port: 8000 });

// ...other middlewares
server.route({
    config: {
        // highlight-start
        cors: {
            origin: websiteUrl
            additionalHeaders: [...supertokens.getAllCORSHeaders()],
            credentials: true,
        }
        // highlight-end
    }
});

(async() => {
    // highlight-next-line
    await server.register(plugin);
    
    await server.start();
})();

// ...your API routes
```
This `plugin` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)) as well take care of all the errors thrown by the Supertokens library:
- `POST /auth/signup`: For signing up a user with email & password
- `POST /auth/signin`: For signing in a user with email & password

`/auth/` is a base path that [can be changed](../common-customizations/changing-base-path/api-base-path) if you want. 


</TabItem>
<TabItem value="fastify">

Register the `plugin`.

```jsx
let cors = require("fastify-cors");
let supertokens = require("supertokens-node");
let { plugin } = require("supertokens-node/framework/fastify");

supertokens.init({...}) // from step 2

let fastify = require('fastify')();

// ...other middlewares
fastify.register(cors, { 
    origin: websiteUrl
    allowedHeaders: ['Content-Type', ...supertokens.getAllCORSHeaders()],
    credentials: true,
})

(async() => {
    // highlight-next-line
    await server.register(plugin);
    
    await server.start();
})();

// ...your API routes
```
This `plugin` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)):
- `POST /auth/signup`: For signing up a user with email & password
- `POST /auth/signin`: For signing in a user with email & password

`/auth/` is a base path that [can be changed](../common-customizations/changing-base-path/api-base-path) if you want. 


</TabItem>
<TabItem value="koa">

Add the `middleware` **BEFORE all your routes**.

```jsx
let cors = require('@koa/cors');
let supertokens = require("supertokens-node");
let {middleware} = require("supertokens-node/framework/koa");

supertokens.init({...}) // from step 2

let app = new Koa();

// ...other middlewares
app.use(cors({
    origin: websiteUrl,
    // highlight-start
    allowHeaders: ["content-type", ...supertokens.getAllCORSHeaders()],
    credentials: true,
    // highlight-end
}));

// highlight-next-line
app.use(middleware());

// ...your API routes
```
This `middleware` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)):
- `POST /auth/signup`: For signing up a user with email & password
- `POST /auth/signin`: For signing in a user with email & password

`/auth/` is a base path that [can be changed](../common-customizations/changing-base-path/api-base-path) if you want. 


</TabItem>
<TabItem value="loopback">

Add the `middleware` **BEFORE all your routes**.

```tsx
import supertokens from "supertokens-node";
import {middleware} from "supertokens-node/framework/loopback";

supertokens.init({...}) // from step 2

let app = new RestApplication({
    rest: {
        cors: {
            origin: websiteUrl,
            // highlight-start
            allowedHeaders: ["content-type", ...supertokens.getAllCORSHeaders()],
            credentials: true
            // highlight-end
        }
    }
});

// highlight-next-line
app.middleware(middleware);

// ...your API routes
```
This `middleware` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)):
- `POST /auth/signup`: For signing up a user with email & password
- `POST /auth/signin`: For signing in a user with email & password

`/auth/` is a base path that [can be changed](../common-customizations/changing-base-path/api-base-path) if you want. 


</TabItem>
</NodeJSFrameworkSubTabsServerless>
</TabItem>
<TabItem value="go">
<GoFrameworkSubTabs>
<TabItem value="http">

Use the `supertokens.Middleware` and the `supertokens.GetAllCORSHeaders()` functions as shown below.

```go
import (
	"net/http"
	"strings"

	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
    // SuperTokens init...

    //highlight-start
	http.ListenAndServe("SERVER ADDRESS", corsMiddleware(
		supertokens.Middleware(http.HandlerFunc(func(rw http.ResponseWriter,
    //highlight-end
        r *http.Request) {
			// TODO: Handle your APIs..

		}))))
}

func corsMiddleware(next http.Handler) http.Handler {
	return http.HandlerFunc(func(response http.ResponseWriter, r *http.Request) {
		response.Header().Set("Access-Control-Allow-Origin", "YOUR WEBSITE DOMAIN")
		response.Header().Set("Access-Control-Allow-Credentials", "true")
		if r.Method == "OPTIONS" {
			// we add content-type + other headers used by SuperTokens
			response.Header().Set("Access-Control-Allow-Headers",
				strings.Join(append([]string{"Content-Type"},
                //highlight-start
					supertokens.GetAllCORSHeaders()...), ","))
                //highlight-end
			response.Header().Set("Access-Control-Allow-Methods", "*")
			response.Write([]byte(""))
		} else {
			next.ServeHTTP(response, r)
		}
	})
}
```

</TabItem>
<TabItem value="gin">

Use the `supertokens.Middleware` and the `supertokens.GetAllCORSHeaders()` functions as shown below.

```go
import (
	"net/http"
	"time"

	"github.com/gin-contrib/cors"
	"github.com/gin-gonic/gin"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
    // SuperTokens init...

	router := gin.New()

	// CORS
	router.Use(cors.New(cors.Config{
		AllowOrigins: []string{"YOUR WEBSITE DOMAIN"},
		AllowMethods: []string{"GET", "POST", "DELETE", "PUT", "OPTIONS"},
		AllowHeaders: append([]string{"content-type"},
        // highlight-next-line
			supertokens.GetAllCORSHeaders()...),
		AllowCredentials: true,
	}))

	// Adding the SuperTokens middleware
    // highlight-start
	router.Use(func(c *gin.Context) {
		supertokens.Middleware(http.HandlerFunc(
			func(rw http.ResponseWriter, r *http.Request) {
				c.Next()
			})).ServeHTTP(c.Writer, c.Request)
		// we call Abort so that the next handler in the chain is not called, unless we call Next explicitly
		c.Abort()
	})
    // highlight-end

	// TODO: Add APIs and start server
}
```

</TabItem>
<TabItem value="chi">

Use the `supertokens.Middleware` and the `supertokens.GetAllCORSHeaders()` functions as shown below.

```go
import (
	"github.com/go-chi/chi"
	"github.com/go-chi/cors"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
    // SuperTokens init...
    
	r := chi.NewRouter()

	// CORS
	r.Use(cors.Handler(cors.Options{
		AllowedOrigins: []string{"YOUR WEBSITE DOMAIN"},
		AllowedMethods: []string{"GET", "POST", "PUT", "DELETE", "OPTIONS"},
		AllowedHeaders: append([]string{"Content-Type"},
			//highlight-next-line
			supertokens.GetAllCORSHeaders()...),
		AllowCredentials: true,
	}))

	// SuperTokens Middleware
	//highlight-next-line
	r.Use(supertokens.Middleware)

	// TODO: Add APIs and start server
}
```
</TabItem>
<TabItem value="mux">

Use the `supertokens.Middleware` and the `supertokens.GetAllCORSHeaders()` functions as shown below.

```go
import (
	"net/http"

	"github.com/gorilla/handlers"
	"github.com/gorilla/mux"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
	// SuperTokens init...

	// TODO: Add APIs

	router := mux.NewRouter()

	// Adding handlers.CORS(options)(supertokens.Middleware(router)))
	//highlight-start
	http.ListenAndServe("SERVER ADDRESS", handlers.CORS(
		handlers.AllowedHeaders(append([]string{"Content-Type"},
			supertokens.GetAllCORSHeaders()...)),
		handlers.AllowedMethods([]string{"GET", "POST", "PUT", "HEAD", "OPTIONS"}),
		handlers.AllowedOrigins([]string{"YOUR WEBSITE DOMAIN"}),
		handlers.AllowCredentials(),
	)(supertokens.Middleware(router)))
	//highlight-end
}
```
</TabItem>
</GoFrameworkSubTabs>

This `Middleware` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)):
- `POST /auth/signup`: For signing up a user with email & password
- `POST /auth/signin`: For signing in a user with email & password

`/auth/` is a base path that [can be changed](../common-customizations/changing-base-path/api-base-path) if you want. 

</TabItem>
</BackendSDKTabs>

:::tip security
Please carefully set your CORS rules. It is **very important to explicitly set a list of allowed origins**. When adding origins make sure to add the full website URL. For example, if the domain is `example.com` make sure the value set is `https://example.com` (against the `Access-Control-Allow-Origin header`).
:::

## 4Ô∏è) Add the SuperTokens error handler

<BackendSDKTabs>
<TabItem value="nodejs">
<NodeJSFrameworkSubTabsServerless>
<TabItem value="express">

Add the `errorHandler` **AFTER all your routes**, but **BEFORE your own error handler**

```jsx
let {errorHandler} = require("supertokens-node/framework/express");
// ...your API routes

// highlight-next-line
app.use(errorHandler())

// your own error handler
app.use((err, req, res, next) => {...});

```
</TabItem>
<TabItem value="hapi">

No additional `errorHandler` is required.

</TabItem>
<TabItem value="fastify">

Add the `errorHandler` **Before all your routes and plugin registration**

```jsx
let {errorHandler} = require("supertokens-node/framework/fastify");

// highlight-next-line
fastify.setErrorHandler(errorHandler());

// ...your API routes

```
</TabItem>
<TabItem value="koa">

No additional `errorHandler` is required.

</TabItem>
<TabItem value="loopback">

No additional `errorHandler` is required.

</TabItem>
</NodeJSFrameworkSubTabsServerless>
</TabItem>
<TabItem value="go">

:::info
You can skip this step
:::

</TabItem>
</BackendSDKTabs>

## 5Ô∏è) Test if sign up is setup correctly
- Go to the `/auth` route of your **website**
- Try to sign up.
- If after signing up, you are redirected to `/`, everything is setup correctly üòÅ
- If not, you can always ask for help via [Github issues](https://github.com/supertokens/supertokens-core/issues) or via [our Discord](https://supertokens.io/discord)

## 6Ô∏è) Add session verification
For your APIs that require a user to be logged in, use the `verifySession` middleware:

<BackendSDKTabs>
<TabItem value="nodejs">
<NodeJSFrameworkSubTabsServerless>
<TabItem value="express">

```jsx
let { verifySession } = require("supertokens-node/recipe/session/framework/express");

//highlight-start
app.post("/like-comment", verifySession(), (req, res) => {
    let userId = req.session.getUserId();
    //highlight-end
    //....
});
```
</TabItem>
<TabItem value="hapi">

```jsx
let { verifySession } = require("supertokens-node/recipe/session/framework/hapi");

server.route({
    path: "/like-comment",
    method: "post",
    //highlight-start
    options: {
        pre: [
            {
                method: verifySession()
            },
        ],
    },
    handler: async (req, res) => {
        let userId = req.session.getUserId();
        //highlight-end
        //...
    }
})
```
</TabItem>
<TabItem value="fastify">

```jsx
let { verifySession } = require("supertokens-node/recipe/session/framework/fastify");

//highlight-start
fastify.post("/like-comment", {
    preHandler: verifySession(),
}, (req, res) => {
    let userId = req.session.getUserId();
    //highlight-end
    //....
});
```
</TabItem>
<TabItem value="koa">

```jsx
let { verifySession } = require("supertokens-node/recipe/session/framework/fastify");

//highlight-start
router.post("/like-comment", verifySession(), (ctx, next) => {
    let userId = ctx.session.getUserId();
    //highlight-end
    //....
});
```

</TabItem>
<TabItem value="loopback">

```tsx
import { verifySession } from "supertokens-node/recipe/session/framework/loopback";

class LikeComment {
    //highlight-start
    constructor(@inject(RestBindings.Http.CONTEXT) private ctx: MiddlewareContext) {}
    @post("/like-comment")
    @intercept(verifySession())
    @response(200)
    handler() {
        let userId = ((this.ctx as any).session as Session.SessionContainer).getUserId();
        //highlight-end
        //....
    }
}
```

</TabItem>
</NodeJSFrameworkSubTabsServerless>
</TabItem>
<TabItem value="go">
<GoFrameworkSubTabs>
<TabItem value="http">

```go
import (
	"net/http"

	"github.com/supertokens/supertokens-golang/recipe/session"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
	http.ListenAndServe("SERVER ADDRESS", corsMiddleware(
		supertokens.Middleware(http.HandlerFunc(func(rw http.ResponseWriter, r *http.Request) {
			// Handle your APIs..
			if r.URL.Path == "/sessioninfo" {
				// Calling the API with session verification
				//highlight-next-line
				session.VerifySession(nil, sessioninfo).ServeHTTP(rw, r)
				return
			}
		}))))
}

// This is the API handler.
func sessioninfo(w http.ResponseWriter, r *http.Request) {
    // Fetching the session object and reading the userID
    //highlight-start
	sessionContainer := session.GetSessionFromRequestContext(r.Context())
	userId := sessionContainer.GetUserID()
    //highlight-end

	// TODO: API logic..
}
```
</TabItem>
<TabItem value="gin">

```go
import (
	"net/http"

	"github.com/gin-gonic/gin"
	"github.com/supertokens/supertokens-golang/recipe/session"
	"github.com/supertokens/supertokens-golang/recipe/session/sessmodels"
)

func main() {
	router := gin.New()

	//highlight-next-line
	router.GET("/sessioninfo", verifySession(nil), sessioninfo)
}

// Wrap session.VerifySession to work with Gin
//highlight-start
func verifySession(options *sessmodels.VerifySessionOptions) gin.HandlerFunc {
	return func(c *gin.Context) {
		session.VerifySession(options, func(rw http.ResponseWriter, r *http.Request) {
			c.Request = c.Request.WithContext(r.Context())
			c.Next()
		})(c.Writer, c.Request)
		// we call Abort so that the next handler in the chain is not called, unless we call Next explicitly
		c.Abort()
	}
}

//highlight-end

// This is the API handler.
func sessioninfo(c *gin.Context) {
	// Fetching the session object and reading the userID
	//highlight-start
	sessionContainer := session.GetSessionFromRequestContext(c.Request.Context())
	userId := sessionContainer.GetUserID()
	//highlight-end

	// TODO: API logic..
}

```

</TabItem>
<TabItem value="chi">

```go
import (
	"net/http"

	"github.com/go-chi/chi"
	"github.com/supertokens/supertokens-golang/recipe/session"
)

func main() {
	r := chi.NewRouter()

	//highlight-next-line
	r.Get("/sessioninfo", session.VerifySession(nil, sessioninfo))
}

// This is the API handler.
func sessioninfo(w http.ResponseWriter, r *http.Request) {
	// Fetching the session object and reading the userID
	//highlight-start
	sessionContainer := session.GetSessionFromRequestContext(r.Context())
	userId := sessionContainer.GetUserID()
	//highlight-end

	// TODO: API logic..
}
```

</TabItem>
<TabItem value="mux">

```go
import (
	"net/http"

	"github.com/gorilla/mux"
	"github.com/supertokens/supertokens-golang/recipe/session"
)

func main() {
	router := mux.NewRouter()

	//highlight-start
	router.HandleFunc("/sessioninfo", 
        session.VerifySession(nil, sessioninfo))
            .Methods(http.MethodGet)
    //highlight-end
}

// This is the API handler.
func sessioninfo(w http.ResponseWriter, r *http.Request) {
	// Fetching the session object and reading the userID
	//highlight-start
	sessionContainer := session.GetSessionFromRequestContext(r.Context())
	userId := sessionContainer.GetUserID()
	//highlight-end

	// TODO: API logic..
}
```

</TabItem>
</GoFrameworkSubTabs>
</TabItem>
</BackendSDKTabs>

---------------

## Minimum setup completed üéâü•≥
Congratulations! You now have a fully functional login and session system!

The next steps is to setup your SuperTokens core instance.