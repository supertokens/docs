---
id: backend
title: "Step 2: Backend"
hide_title: true
---

<!-- COPY DOCS -->
<!-- ./thirdpartypasswordless/pre-built-ui/setup/backend.mdx -->

import BackendSDKTabs from "/src/components/tabs/BackendSDKTabs";
import TabItem from '@theme/TabItem';
import NodeJSFrameworkSubTabsServerless from "/src/components/tabs/NodeJSFrameworkSubTabsServerless"
import PythonFrameworkSubTabs from "/src/components/tabs/PythonFrameworkSubTabs"
import GoFrameworkSubTabs from "/src/components/tabs/GoFrameworkSubTabs"
import AppInfoForm from "/src/components/appInfoForm"
import { PasswordlessBackendForm } from "/src/components/snippetConfigForm/passwordlessBackendForm";
import CoreInjector from "/src/components/coreInjector"
import { Question, Answer }from "/src/components/question"
import BackendSDKCasing from "/src/components/BackendSDKCasing"
import BackendDeliveryMethod from "../../../passwordless/reusableMD/backendDeliveryMethod.mdx"

# Backend Integration

## Supported frameworks

import TechStackSupport from "../../../community/reusableMD/supported-tech-stacks-backend.mdx"

<TechStackSupport />

## 1) Install

<BackendSDKTabs>
<TabItem value="nodejs">

```bash
npm i -s supertokens-node
```

</TabItem>
<TabItem value="go">

```bash
go get github.com/supertokens/supertokens-golang
```

</TabItem>
<TabItem value="python">

```bash
pip install supertokens-python
```

</TabItem>
</BackendSDKTabs>

## 2) Initialise SuperTokens

<AppInfoForm
    askForAppName
    askForAPIDomain
    askForWebsiteDomain
>

<PasswordlessBackendForm>
<CoreInjector showTenantId={false}>

Add the code below to your server's init file.

<BackendSDKTabs>
<TabItem value="nodejs">

<NodeJSFrameworkSubTabsServerless>
<TabItem value="express">

```tsx
import supertokens from "supertokens-node";
import Session from "supertokens-node/recipe/session";
import ThirdPartyPasswordless from "supertokens-node/recipe/thirdpartypasswordless";

supertokens.init({
    framework: "express",
    supertokens: {
        ^{coreInjector_connection_uri_comment}
        connectionURI: ^{coreInjector_uri}
        ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
    appInfo: {
        // learn more about this on https://supertokens.com/docs/session/appinfo
        appName: "^{form_appName}",
        apiDomain: "^{form_apiDomain}",
        websiteDomain: "^{form_websiteDomain}",
        apiBasePath: "^{form_apiBasePath}",
        websiteBasePath: "^{form_websiteBasePath}"
    },
    recipeList: [
        ThirdPartyPasswordless.init({
            flowType: "^{form_flowType}",
            contactMethod: "^{form_contactMethod}"
            /*TODO: See next steps for third party provider setup */
        }),
        Session.init() // initializes session features
    ]
});
```

</TabItem>

<TabItem value="hapi">

```tsx
import supertokens from "supertokens-node";
import Session from "supertokens-node/recipe/session";
import ThirdPartyPasswordless from "supertokens-node/recipe/thirdpartypasswordless";

supertokens.init({
    framework: "hapi",
    supertokens: {
        ^{coreInjector_connection_uri_comment}
        connectionURI: ^{coreInjector_uri}
        ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
    appInfo: {
        // learn more about this on https://supertokens.com/docs/session/appinfo
        appName: "^{form_appName}",
        apiDomain: "^{form_apiDomain}",
        websiteDomain: "^{form_websiteDomain}",
        apiBasePath: "^{form_apiBasePath}",
        websiteBasePath: "^{form_websiteBasePath}"
    },
    recipeList: [
        ThirdPartyPasswordless.init({
            flowType: "^{form_flowType}",
            contactMethod: "^{form_contactMethod}"
            /*TODO: See next steps for third party provider setup */
        }),
        Session.init() // initializes session features
    ]
});
```
</TabItem>

<TabItem value="fastify">

```tsx
import supertokens from "supertokens-node";
import Session from "supertokens-node/recipe/session";
import ThirdPartyPasswordless from "supertokens-node/recipe/thirdpartypasswordless";

supertokens.init({
    framework: "fastify",
    supertokens: {
        ^{coreInjector_connection_uri_comment}
        connectionURI: ^{coreInjector_uri}
        ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
    appInfo: {
        // learn more about this on https://supertokens.com/docs/session/appinfo
        appName: "^{form_appName}",
        apiDomain: "^{form_apiDomain}",
        websiteDomain: "^{form_websiteDomain}",
        apiBasePath: "^{form_apiBasePath}",
        websiteBasePath: "^{form_websiteBasePath}"
    },
    recipeList: [
        ThirdPartyPasswordless.init({
            flowType: "^{form_flowType}",
            contactMethod: "^{form_contactMethod}"
            /*TODO: See next steps for third party provider setup */
        }),
        Session.init() // initializes session features
    ]
});
```
</TabItem>

<TabItem value="koa">

```tsx
import supertokens from "supertokens-node";
import Session from "supertokens-node/recipe/session";
import ThirdPartyPasswordless from "supertokens-node/recipe/thirdpartypasswordless";

supertokens.init({
    framework: "koa",
    supertokens: {
        ^{coreInjector_connection_uri_comment}
        connectionURI: ^{coreInjector_uri}
        ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
    appInfo: {
        // learn more about this on https://supertokens.com/docs/session/appinfo
        appName: "^{form_appName}",
        apiDomain: "^{form_apiDomain}",
        websiteDomain: "^{form_websiteDomain}",
        apiBasePath: "^{form_apiBasePath}",
        websiteBasePath: "^{form_websiteBasePath}"
    },
    recipeList: [
        ThirdPartyPasswordless.init({
            flowType: "^{form_flowType}",
            contactMethod: "^{form_contactMethod}"
            /*TODO: See next steps for third party provider setup */
        }),
        Session.init() // initializes session features
    ]
});
```
</TabItem>

<TabItem value="loopback">

```tsx
import supertokens from "supertokens-node";
import Session from "supertokens-node/recipe/session";
import ThirdPartyPasswordless from "supertokens-node/recipe/thirdpartypasswordless";

supertokens.init({
    framework: "loopback",
    supertokens: {
        ^{coreInjector_connection_uri_comment}
        connectionURI: ^{coreInjector_uri}
        ^{coreInjector_api_key_commented}apiKey: ^{coreInjector_api_key},
    },
    appInfo: {
        // learn more about this on https://supertokens.com/docs/session/appinfo
        appName: "^{form_appName}",
        apiDomain: "^{form_apiDomain}",
        websiteDomain: "^{form_websiteDomain}",
        apiBasePath: "^{form_apiBasePath}",
        websiteBasePath: "^{form_websiteBasePath}"
    },
    recipeList: [
        ThirdPartyPasswordless.init({
            flowType: "^{form_flowType}",
            contactMethod: "^{form_contactMethod}"
            /*TODO: See next steps for third party provider setup */
        }),
        Session.init() // initializes session features
    ]
});
```
</TabItem>
</NodeJSFrameworkSubTabsServerless>
</TabItem>
<TabItem value="go">

```go
import (
    "github.com/supertokens/supertokens-golang/recipe/passwordless/plessmodels"
	"github.com/supertokens/supertokens-golang/recipe/session"
	"github.com/supertokens/supertokens-golang/recipe/thirdpartypasswordless"
	"github.com/supertokens/supertokens-golang/recipe/thirdpartypasswordless/tplmodels"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
    apiBasePath := "^{form_apiBasePath}"
    websiteBasePath := "^{form_websiteBasePath}"
	err := supertokens.Init(supertokens.TypeInput{
		Supertokens: &supertokens.ConnectionInfo{
            ^{coreInjector_connection_uri_comment}
            ConnectionURI: ^{coreInjector_uri}
            ^{coreInjector_api_key_commented}APIKey: ^{coreInjector_api_key},
		},
		AppInfo: supertokens.AppInfo{
            AppName: "^{form_appName}",
            APIDomain: "^{form_apiDomain}",
            WebsiteDomain: "^{form_websiteDomain}",
            APIBasePath: &apiBasePath,
            WebsiteBasePath: &websiteBasePath,
		},
		RecipeList: []supertokens.Recipe{
			thirdpartypasswordless.Init(tplmodels.TypeInput{
                FlowType: "^{form_flowType}",
                ^{form_contactMethod_sendCB_Go}
                /*TODO: See next steps for third party provider setup */
            }),
			session.Init(nil), // initializes session features
		},
	})

	if err != nil {
		panic(err.Error())
	}
}
```
</TabItem>
<TabItem value="python">
<PythonFrameworkSubTabs>

<TabItem value="fastapi">

```python
from supertokens_python import init, InputAppInfo, SupertokensConfig
from supertokens_python.recipe import thirdpartypasswordless, session

^{form_contactMethod_import_Python}
init(
    app_info=InputAppInfo(
        app_name="^{form_appName}",
        api_domain="^{form_apiDomain}",
        website_domain="^{form_websiteDomain}",
        api_base_path="^{form_apiBasePath}",
        website_base_path="^{form_websiteBasePath}"
    ),
    supertokens_config=SupertokensConfig(
        ^{coreInjector_connection_uri_comment_with_hash}
        connection_uri=^{coreInjector_uri}
        ^{coreInjector_api_key_commented_with_hash}api_key=^{coreInjector_api_key}
    ),
    framework='fastapi',
    recipe_list=[
	    session.init(), # initializes session features
        thirdpartypasswordless.init(
            flow_type="^{form_flowType}",
            contact_config=^{form_contactMethod_initialize_Python}()
            # TODO: See next steps for third party provider setup 
        )
    ],
    mode='asgi' # use wsgi if you are running using gunicorn
)
```

</TabItem>
<TabItem value="flask">

```python
from supertokens_python import init, InputAppInfo, SupertokensConfig
from supertokens_python.recipe import thirdpartypasswordless, session

^{form_contactMethod_import_Python}
init(
    app_info=InputAppInfo(
        app_name="^{form_appName}",
        api_domain="^{form_apiDomain}",
        website_domain="^{form_websiteDomain}",
        api_base_path="^{form_apiBasePath}",
        website_base_path="^{form_websiteBasePath}"
    ),
    supertokens_config=SupertokensConfig(
        ^{coreInjector_connection_uri_comment_with_hash}
        connection_uri=^{coreInjector_uri}
        ^{coreInjector_api_key_commented_with_hash}api_key=^{coreInjector_api_key}
    ),
    framework='flask',
    recipe_list=[
	    session.init(), # initializes session features
        thirdpartypasswordless.init(
            flow_type="^{form_flowType}",
            contact_config=^{form_contactMethod_initialize_Python}()
            # TODO: See next steps for third party provider setup 
        )
    ]
)
```

</TabItem>
<TabItem value="django">

```python
from supertokens_python import init, InputAppInfo, SupertokensConfig
from supertokens_python.recipe import thirdpartypasswordless, session

^{form_contactMethod_import_Python}
init(
    app_info=InputAppInfo(
        app_name="^{form_appName}",
        api_domain="^{form_apiDomain}",
        website_domain="^{form_websiteDomain}",
        api_base_path="^{form_apiBasePath}",
        website_base_path="^{form_websiteBasePath}"
    ),
    supertokens_config=SupertokensConfig(
        ^{coreInjector_connection_uri_comment_with_hash}
        connection_uri=^{coreInjector_uri}
        ^{coreInjector_api_key_commented_with_hash}api_key=^{coreInjector_api_key}
    ),
    framework='django',
    recipe_list=[
	    session.init(), # initializes session features
        thirdpartypasswordless.init(
            flow_type="^{form_flowType}",
            contact_config=^{form_contactMethod_initialize_Python}()
            # TODO: See next steps for third party provider setup 
        )
    ],
    mode='asgi' # use wsgi if you are running django server in sync mode
)
```

</TabItem>
</PythonFrameworkSubTabs>
</TabItem>
</BackendSDKTabs>

</CoreInjector>

</PasswordlessBackendForm>

</AppInfoForm>

## 3) Initialise Social login providers

<AppInfoForm
    askForWebsiteDomain
    askForAPIDomain
>
<PasswordlessBackendForm>

Populate the `providers` array with the third party auth providers you want.

<BackendSDKTabs>
<TabItem value="nodejs">

```tsx
import SuperTokens from "supertokens-node";
import ThirdPartyPasswordless from "supertokens-node/recipe/thirdpartypasswordless";

SuperTokens.init({
    appInfo: {
        apiDomain: "...",
        appName: "...",
        websiteDomain: "...",
    },
    recipeList: [
        ThirdPartyPasswordless.init({
            flowType: "^{form_flowType}",
            contactMethod: "^{form_contactMethod}",
            //highlight-start
            // We have provided you with development keys which you can use for testing.
            // IMPORTANT: Please replace them with your own OAuth keys for production use.
            providers: [{
                config: {
                    thirdPartyId: "google",
                    clients: [{
                        clientId: "1060725074195-kmeum4crr01uirfl2op9kd5acmi9jutn.apps.googleusercontent.com",
                        clientSecret: "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"
                    }]
                }
            }, {
                config: {
                    thirdPartyId: "github",
                    clients: [{
                        clientId: "467101b197249757c71f",
                        clientSecret: "e97051221f4b6426e8fe8d51486396703012f5bd"
                    }]
                }
            }, {
                config: {
                    thirdPartyId: "apple",
                    clients: [{
                        clientId: "4398792-io.supertokens.example.service",
                        additionalConfig: {
                            keyId: "7M48Y4RYDL",
                            privateKey:
                                "-----BEGIN PRIVATE KEY-----\nMIGTAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBHkwdwIBAQQgu8gXs+XYkqXD6Ala9Sf/iJXzhbwcoG5dMh1OonpdJUmgCgYIKoZIzj0DAQehRANCAASfrvlFbFCYqn3I2zeknYXLwtH30JuOKestDbSfZYxZNMqhF/OzdZFTV0zc5u5s3eN+oCWbnvl0hM+9IW0UlkdA\n-----END PRIVATE KEY-----",
                            teamId: "YWQCXGJRJL",
                        }
                    }]
                }
            }],
            //highlight-end
        }),
        // ...
    ]
});
```
</TabItem>
<TabItem value="go">

```go

import (
    "github.com/supertokens/supertokens-golang/recipe/thirdparty"
	"github.com/supertokens/supertokens-golang/recipe/thirdparty/tpmodels"
	"github.com/supertokens/supertokens-golang/recipe/^{codeImportRecipeName}"
	"github.com/supertokens/supertokens-golang/recipe/^{codeImportRecipeName}/^{goModelName}"
)

func main() {

    // Inside supertokens.Init -> RecipeList
    ^{codeImportRecipeName}.Init(^{goModelNameForInit}.TypeInput{
        // highlight-start
        Providers: []tpmodels.TypeProvider{
			// We have provided you with development keys which you can use for testing.
			// IMPORTANT: Please replace them with your own OAuth keys for production use.
			thirdparty.Google(tpmodels.GoogleConfig{
				ClientID:     "1060725074195-kmeum4crr01uirfl2op9kd5acmi9jutn.apps.googleusercontent.com",
				ClientSecret: "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",
			}),
			thirdparty.Github(tpmodels.GithubConfig{
				ClientID:     "467101b197249757c71f",
				ClientSecret: "e97051221f4b6426e8fe8d51486396703012f5bd",
			}),
			thirdparty.Apple(tpmodels.AppleConfig{
				ClientID: "4398792-io.supertokens.example.service",
				ClientSecret: tpmodels.AppleClientSecret{
					KeyId:      "7M48Y4RYDL",
					PrivateKey: "-----BEGIN PRIVATE KEY-----\nMIGTAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBHkwdwIBAQQgu8gXs+XYkqXD6Ala9Sf/iJXzhbwcoG5dMh1OonpdJUmgCgYIKoZIzj0DAQehRANCAASfrvlFbFCYqn3I2zeknYXLwtH30JuOKestDbSfZYxZNMqhF/OzdZFTV0zc5u5s3eN+oCWbnvl0hM+9IW0UlkdA\n-----END PRIVATE KEY-----",
					TeamId:     "YWQCXGJRJL",
				},
			}),
		},
        // highlight-end
    })
}
```
</TabItem>
<TabItem value="python">

```python
from supertokens_python.recipe.^{codeImportRecipeName} import Google, Github, Apple
from supertokens_python.recipe import ^{codeImportRecipeName}

# Inside init
^{codeImportRecipeName}.init(
    ^{pythonRecipeInitDefault} # typecheck-only, removed from output
    # highlight-start
    providers=[
        # We have provided you with development keys which you can use for testing.
        # IMPORTANT: Please replace them with your own OAuth keys for production use.
        Google(
            client_id='1060725074195-kmeum4crr01uirfl2op9kd5acmi9jutn.apps.googleusercontent.com',
            client_secret='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'
        ),
        Github(
            client_id='467101b197249757c71f',
            client_secret='e97051221f4b6426e8fe8d51486396703012f5bd'
        ),
        Apple(
            client_id="4398792-io.supertokens.example.service",
            client_key_id="7M48Y4RYDL",
            client_private_key="-----BEGIN PRIVATE KEY-----\nMIGTAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBHkwdwIBAQQgu8gXs+XYkqXD6Ala9Sf/iJXzhbwcoG5dMh1OonpdJUmgCgYIKoZIzj0DAQehRANCAASfrvlFbFCYqn3I2zeknYXLwtH30JuOKestDbSfZYxZNMqhF/OzdZFTV0zc5u5s3eN+oCWbnvl0hM+9IW0UlkdA\n-----END PRIVATE KEY-----",
            client_team_id="YWQCXGJRJL"
        )
    ]
    # highlight-end
)
```

</TabItem>
</BackendSDKTabs>

**When you want to generate your own keys**, please refer to the corresponding documentation to get your client ids and client secrets for each of the below providers:

<details>
<summary>Google</summary>

- Generate your client ID and secret by following the [docs here](https://support.google.com/cloud/answer/6158849?hl=en)
- Set the authorisation callback URL to `^{form_websiteDomain}^{form_websiteBasePathForCallbacks}/callback/google`

</details>

<details>
<summary>Github</summary>

- Generate your client ID and secret by following the [docs here](https://docs.github.com/en/developers/apps/creating-an-oauth-app)
- Set the authorisation callback URL to `^{form_websiteDomain}^{form_websiteBasePathForCallbacks}/callback/github`

</details>

<details>
<summary>Apple</summary>

- Generate your client ID and secret by following [this article](https://medium.com/identity-beyond-borders/how-to-configure-sign-in-with-apple-77c61e336003)
- Set the authorisation callback URL to `^{form_apiDomain}^{form_apiBasePathForCallbacks}/callback/apple`. Note that Apple doesn't allow `localhost` in the URL. So if you are in dev mode, you can use the dev keys we have provided above.

</details>

</PasswordlessBackendForm>

:::important
You can find the list of built in providers [here](../../common-customizations/signup-form/built-in-providers). To add a provider that is not listed, you can follow our guide on [setting up custom providers](../../common-customizations/signup-form/custom-providers).
:::

</AppInfoForm>

## 4) Add the SuperTokens APIs & CORS setup

<AppInfoForm
    askForWebsiteDomain
    askForAPIBasePath
    hideWebsiteBasePathField
>

<BackendSDKTabs>
<TabItem value="nodejs">
<NodeJSFrameworkSubTabsServerless>
<TabItem value="express">

:::important
- Add the `middleware` BEFORE all your routes.
- Add the `cors` middleware BEFORE the SuperTokens middleware as shown below.
:::

```tsx
import express from "express";
import cors from "cors";
import supertokens from "supertokens-node";
import {middleware} from "supertokens-node/framework/express";

let app = express();

app.use(cors({
    // highlight-start
    origin: "^{form_websiteDomain}",
    allowedHeaders: ["content-type", ...supertokens.getAllCORSHeaders()],
    credentials: true,
    // highlight-end
}));

// IMPORTANT: CORS should be before the below line.
// highlight-next-line
app.use(middleware());

// ...your API routes
```
This `middleware` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)):
- `POST ^{form_apiBasePath}/signinup/code`: For starting the passwordless login/sign up process
- `POST ^{form_apiBasePath}/signinup/code/resend`: To generate and resend a code during an already started login/sign up process
- `POST ^{form_apiBasePath}/signinup/code/consume`: For finishing the passwordless login/sign up process
- `GET ^{form_apiBasePath}/signup/email/exists`: To check if an email is already signed up
- `GET ^{form_apiBasePath}/signup/phonenumber/exists`: To check if a phonenumber is already signed up
- `POST ^{form_apiBasePath}/signinup`: For signing up/signing in a user using a thirdparty provider.

</TabItem>
<TabItem value="hapi">

Register the `plugin`.

```tsx
import Hapi from "@hapi/hapi";
import supertokens from "supertokens-node";
import { plugin } from "supertokens-node/framework/hapi";

const server = Hapi.server({ 
    port: 8000, 
    routes: {
        // highlight-start
        cors: {
            origin: ["^{form_websiteDomain}"],
            additionalHeaders: [...supertokens.getAllCORSHeaders()],
            credentials: true,
        }
        // highlight-end
    }
});

(async() => {
    // highlight-next-line
    await server.register(plugin);

    await server.start();
})();

// ...your API routes
```
This `plugin` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)) as well take care of all the errors thrown by the Supertokens library:
- `POST ^{form_apiBasePath}/signinup/code`: For starting the passwordless login/sign up process
- `POST ^{form_apiBasePath}/signinup/code/resend`: To generate and resend a code during an already started login/sign up process
- `POST ^{form_apiBasePath}/signinup/code/consume`: For finishing the passwordless login/sign up process
- `GET ^{form_apiBasePath}/signup/email/exists`: To check if an email is already signed up
- `GET ^{form_apiBasePath}/signup/phonenumber/exists`: To check if a phonenumber is already signed up
- `POST ^{form_apiBasePath}/signinup`: For signing up/signing in a user using a thirdparty provider.


</TabItem>
<TabItem value="fastify">

Register the `plugin`. Also register [`@fastify/formbody`](https://github.com/fastify/fastify-formbody) plugin.

```tsx
import cors from "@fastify/cors";
import supertokens from "supertokens-node";
import { plugin } from "supertokens-node/framework/fastify";
import formDataPlugin from "@fastify/formbody";

import fastifyImport from "fastify";
let fastify = fastifyImport();

// ...other middlewares
(async () => {
    // highlight-start
    await fastify.register(cors, {
        origin: "^{form_websiteDomain}",
        allowedHeaders: ['Content-Type', ...supertokens.getAllCORSHeaders()],
        credentials: true,
    })
    // highlight-end
    // highlight-next-line
    await fastify.register(formDataPlugin);
    // highlight-next-line
    await fastify.register(plugin);

    await fastify.listen(3000);
})();

// ...your API routes
```
This `plugin` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)):
- `POST ^{form_apiBasePath}/signinup/code`: For starting the passwordless login/sign up process
- `POST ^{form_apiBasePath}/signinup/code/resend`: To generate and resend a code during an already started login/sign up process
- `POST ^{form_apiBasePath}/signinup/code/consume`: For finishing the passwordless login/sign up process
- `GET ^{form_apiBasePath}/signup/email/exists`: To check if an email is already signed up
- `GET ^{form_apiBasePath}/signup/phonenumber/exists`: To check if a phonenumber is already signed up
- `POST ^{form_apiBasePath}/signinup`: For signing up/signing in a user using a thirdparty provider.


</TabItem>
<TabItem value="koa">

:::important
Add the `middleware` BEFORE all your routes.
:::

```tsx
import Koa from "koa";
import cors from '@koa/cors';
import supertokens from "supertokens-node";
import { middleware } from "supertokens-node/framework/koa";

let app = new Koa();

// ...other middlewares
app.use(cors({
    // highlight-start
    origin: "^{form_websiteDomain}",
    allowHeaders: ["content-type", ...supertokens.getAllCORSHeaders()],
    credentials: true,
    // highlight-end
}));

// highlight-next-line
app.use(middleware());

// ...your API routes
```
This `middleware` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)):
- `POST ^{form_apiBasePath}/signinup/code`: For starting the passwordless login/sign up process
- `POST ^{form_apiBasePath}/signinup/code/resend`: To generate and resend a code during an already started login/sign up process
- `POST ^{form_apiBasePath}/signinup/code/consume`: For finishing the passwordless login/sign up process
- `GET ^{form_apiBasePath}/signup/email/exists`: To check if an email is already signed up
- `GET ^{form_apiBasePath}/signup/phonenumber/exists`: To check if a phonenumber is already signed up
- `POST ^{form_apiBasePath}/signinup`: For signing up/signing in a user using a thirdparty provider.


</TabItem>
<TabItem value="loopback">

:::important
Add the `middleware` BEFORE all your routes.
:::

```tsx
import {RestApplication} from '@loopback/rest';
import supertokens from "supertokens-node";
import {middleware} from "supertokens-node/framework/loopback";

let app = new RestApplication({
    rest: {
        cors: {
            // highlight-start
            origin: "^{form_websiteDomain}",
            allowedHeaders: ["content-type", ...supertokens.getAllCORSHeaders()],
            credentials: true
            // highlight-end
        }
    }
});

// highlight-next-line
app.middleware(middleware);

// ...your API routes
```
This `middleware` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)):
- `POST ^{form_apiBasePath}/signinup/code`: For starting the passwordless login/sign up process
- `POST ^{form_apiBasePath}/signinup/code/resend`: To generate and resend a code during an already started login/sign up process
- `POST ^{form_apiBasePath}/signinup/code/consume`: For finishing the passwordless login/sign up process
- `GET ^{form_apiBasePath}/signup/email/exists`: To check if an email is already signed up
- `GET ^{form_apiBasePath}/signup/phonenumber/exists`: To check if a phonenumber is already signed up
- `POST ^{form_apiBasePath}/signinup`: For signing up/signing in a user using a thirdparty provider.


</TabItem>
</NodeJSFrameworkSubTabsServerless>
</TabItem>
<TabItem value="go">
<GoFrameworkSubTabs>
<TabItem value="http">

Use the `supertokens.Middleware` and the `supertokens.GetAllCORSHeaders()` functions as shown below.

```go
import (
	"net/http"
	"strings"

	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
    // SuperTokens init...

    //highlight-start
	http.ListenAndServe("SERVER ADDRESS", corsMiddleware(
		supertokens.Middleware(http.HandlerFunc(func(rw http.ResponseWriter,
    //highlight-end
        r *http.Request) {
			// TODO: Handle your APIs..

		}))))
}

func corsMiddleware(next http.Handler) http.Handler {
	return http.HandlerFunc(func(response http.ResponseWriter, r *http.Request) {
		response.Header().Set("Access-Control-Allow-Origin", "^{form_websiteDomain}")
		response.Header().Set("Access-Control-Allow-Credentials", "true")
		if r.Method == "OPTIONS" {
			// we add content-type + other headers used by SuperTokens
			response.Header().Set("Access-Control-Allow-Headers",
				strings.Join(append([]string{"Content-Type"},
                //highlight-start
					supertokens.GetAllCORSHeaders()...), ","))
                //highlight-end
			response.Header().Set("Access-Control-Allow-Methods", "*")
			response.Write([]byte(""))
		} else {
			next.ServeHTTP(response, r)
		}
	})
}
```

</TabItem>
<TabItem value="gin">

Use the `supertokens.Middleware` and the `supertokens.GetAllCORSHeaders()` functions as shown below.

```go
import (
	"net/http"

	"github.com/gin-contrib/cors"
	"github.com/gin-gonic/gin"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
    // SuperTokens init...

	router := gin.New()

	// CORS
	router.Use(cors.New(cors.Config{
		AllowOrigins: []string{"^{form_websiteDomain}"},
		AllowMethods: []string{"GET", "POST", "DELETE", "PUT", "OPTIONS"},
		AllowHeaders: append([]string{"content-type"},
        // highlight-next-line
			supertokens.GetAllCORSHeaders()...),
		AllowCredentials: true,
	}))

	// Adding the SuperTokens middleware
    // highlight-start
	router.Use(func(c *gin.Context) {
		supertokens.Middleware(http.HandlerFunc(
			func(rw http.ResponseWriter, r *http.Request) {
				c.Next()
			})).ServeHTTP(c.Writer, c.Request)
		// we call Abort so that the next handler in the chain is not called, unless we call Next explicitly
		c.Abort()
	})
    // highlight-end

	// Add APIs and start server
}
```

</TabItem>
<TabItem value="chi">

Use the `supertokens.Middleware` and the `supertokens.GetAllCORSHeaders()` functions as shown below.

```go
import (
	"github.com/go-chi/chi"
	"github.com/go-chi/cors"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
    // SuperTokens init...

	r := chi.NewRouter()

	// CORS
	r.Use(cors.Handler(cors.Options{
		AllowedOrigins: []string{"^{form_websiteDomain}"},
		AllowedMethods: []string{"GET", "POST", "PUT", "DELETE", "OPTIONS"},
		AllowedHeaders: append([]string{"Content-Type"},
			//highlight-next-line
			supertokens.GetAllCORSHeaders()...),
		AllowCredentials: true,
	}))

	// SuperTokens Middleware
	//highlight-next-line
	r.Use(supertokens.Middleware)

	// Add APIs and start server
}
```
</TabItem>
<TabItem value="mux">

Use the `supertokens.Middleware` and the `supertokens.GetAllCORSHeaders()` functions as shown below.

```go
import (
	"net/http"

	"github.com/gorilla/handlers"
	"github.com/gorilla/mux"
	"github.com/supertokens/supertokens-golang/supertokens"
)

func main() {
	// SuperTokens init...

	// Add APIs

	router := mux.NewRouter()

	// Adding handlers.CORS(options)(supertokens.Middleware(router)))
	//highlight-start
	http.ListenAndServe("SERVER ADDRESS", handlers.CORS(
		handlers.AllowedHeaders(append([]string{"Content-Type"},
			supertokens.GetAllCORSHeaders()...)),
		handlers.AllowedMethods([]string{"GET", "POST", "PUT", "HEAD", "OPTIONS"}),
		handlers.AllowedOrigins([]string{"^{form_websiteDomain}"}),
		handlers.AllowCredentials(),
	)(supertokens.Middleware(router)))
	//highlight-end
}
```
</TabItem>
</GoFrameworkSubTabs>

This `Middleware` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)):
- `POST ^{form_apiBasePath}/signinup/code`: For starting the passwordless login/sign up process
- `POST ^{form_apiBasePath}/signinup/code/resend`: To generate and resend a code during an already started login/sign up process
- `POST ^{form_apiBasePath}/signinup/code/consume`: For finishing the passwordless login/sign up process
- `GET ^{form_apiBasePath}/signup/email/exists`: To check if an email is already signed up
- `GET ^{form_apiBasePath}/signup/phonenumber/exists`: To check if a phonenumber is already signed up
- `POST ^{form_apiBasePath}/signinup`: For signing up/signing in a user using a thirdparty provider.


</TabItem>
<TabItem value="python">

<PythonFrameworkSubTabs>
<TabItem value="fastapi">

Use the `Middleware` (**BEFORE all your routes**) and the `get_all_cors_headers()` functions as shown below.

```python
from supertokens_python import get_all_cors_headers
from fastapi import FastAPI
from starlette.middleware.cors import CORSMiddleware
from supertokens_python.framework.fastapi import get_middleware

app = FastAPI()
# highlight-next-line
app.add_middleware(get_middleware())

# TODO: Add APIs

app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "^{form_websiteDomain}"
    ],
    allow_credentials=True,
    allow_methods=["GET", "PUT", "POST", "DELETE", "OPTIONS", "PATCH"],
	# highlight-next-line
    allow_headers=["Content-Type"] + get_all_cors_headers(),
)

# TODO: start server
```

</TabItem>
<TabItem value="flask">

- Use the `Middleware` (**BEFORE all your routes and after calling init function**) and the `get_all_cors_headers()` functions as shown below.
- Add a route to catch all paths and return a 404. This is needed because if we don't add this, then OPTIONS request for the APIs exposed by the `Middleware` will return a `404`.

```python
from supertokens_python import get_all_cors_headers
from flask import Flask, abort
from flask_cors import CORS # type: ignore
from supertokens_python.framework.flask import Middleware

app = Flask(__name__)
# highlight-next-line
Middleware(app)

# TODO: Add APIs

CORS(
    app=app,
    origins=[
        "^{form_websiteDomain}"
    ],
    supports_credentials=True,
	# highlight-next-line
    allow_headers=["Content-Type"] + get_all_cors_headers(),
)

# This is required since if this is not there, then OPTIONS requests for
# the APIs exposed by the supertokens' Middleware will return a 404
# highlight-start
@app.route('/', defaults={'u_path': ''})  # type: ignore
@app.route('/<path:u_path>')  # type: ignore
def catch_all(u_path: str):
    abort(404)
# highlight-end

# TODO: start server
```

</TabItem>
<TabItem value="django">

Use the `Middleware` and the `get_all_cors_headers()` functions as shown below in your `settings.py`.

```python
from supertokens_python import get_all_cors_headers
from typing import List
from corsheaders.defaults import default_headers

CORS_ORIGIN_WHITELIST = [
    "^{form_websiteDomain}"
]

CORS_ALLOW_CREDENTIALS = True

CORS_ALLOWED_ORIGINS = [
    "^{form_websiteDomain}"
]

CORS_ALLOW_HEADERS: List[str] = list(default_headers) + [
    "Content-Type"
    # highlight-next-line
] + get_all_cors_headers()

INSTALLED_APPS = [
    'corsheaders',
    'supertokens_python'
]

MIDDLEWARE = [
    'corsheaders.middleware.CorsMiddleware',
    ...,
    # highlight-next-line
    'supertokens_python.framework.django.django_middleware.middleware',
]
```

</TabItem>
</PythonFrameworkSubTabs>

This `Middleware` adds a few APIs (see all the APIs [here](https://app.swaggerhub.com/apis/supertokens/FDI)):
- `POST ^{form_apiBasePath}/signinup/code`: For starting the passwordless login/sign up process
- `POST ^{form_apiBasePath}/signinup/code/resend`: To generate and resend a code during an already started login/sign up process
- `POST ^{form_apiBasePath}/signinup/code/consume`: For finishing the passwordless login/sign up process
- `GET ^{form_apiBasePath}/signup/email/exists`: To check if an email is already signed up
- `GET ^{form_apiBasePath}/signup/phonenumber/exists`: To check if a phonenumber is already signed up
- `POST ^{form_apiBasePath}/signinup`: For signing up/signing in a user using a thirdparty provider.


</TabItem>
</BackendSDKTabs>

</AppInfoForm>

## 5) Add the SuperTokens error handler
Add the `errorHandler` **AFTER all your routes**, but **BEFORE your error handler**

<BackendSDKTabs>
<TabItem value="nodejs">
<NodeJSFrameworkSubTabsServerless>
<TabItem value="express">

```tsx
import express from "express";
import {errorHandler} from "supertokens-node/framework/express";

const app = express();
// ...your API routes

// highlight-start
// Add this AFTER all your routes
app.use(errorHandler())
// highlight-end

// your own error handler
app.use((err: any, req: express.Request, res: express.Response, next: express.NextFunction) => {
    // TODO
});

```
</TabItem>
<TabItem value="hapi">

No additional `errorHandler` is required.

</TabItem>
<TabItem value="fastify">

Add the `errorHandler` **Before all your routes and plugin registration**

```tsx
import Fastify from "fastify";
import {errorHandler} from "supertokens-node/framework/fastify";

const fastify = Fastify();

// highlight-next-line
fastify.setErrorHandler(errorHandler());

// ...your API routes

```
</TabItem>
<TabItem value="koa">

No additional `errorHandler` is required.

</TabItem>
<TabItem value="loopback">

No additional `errorHandler` is required.

</TabItem>
</NodeJSFrameworkSubTabsServerless>
</TabItem>
<TabItem value="go">

:::info
You can skip this step
:::

</TabItem>
<TabItem value="python">

:::info
You can skip this step
:::

</TabItem>
</BackendSDKTabs>

## 6) Setup the SuperTokens core

You need to now setup an instance of the SuperTokens core for your app (that your backend should connect to). You have two options:
- [Managed service](./core/saas-setup)
- Self hosted with your own database ([With Docker](./core/with-docker) or [Without Docker](./core/without-docker))